<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>修改课程</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .form-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin: 20px auto;
            padding: 20px;
            width: 50%;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .inline-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .inline-group label {
            margin-right: 8px;
        }
        button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #4CAF50;
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        /* 隐藏用的 CSS 类 */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>修改课程</h1>

    <div class="form-container">
        <form method="POST" action="{{ url_for('edit', course_index=course_index) }}">
            <!-- 隐藏的字段：告知后端是“编辑”操作，并传递课程索引 -->
            <input type="hidden" name="action" value="edit" />
            <input type="hidden" name="course_index" value="{{ course_index }}" />

            <label for="course_name">课程名称：</label>
            <input type="text" id="course_name" name="course_name"
                   value="{{ course.name }}" required />

            <label for="credit">学分：</label>
            <input type="number" id="credit" name="credit"
                   min="0" step="0.1"
                   value="{{ course.credit }}" required />

            <!-- 成绩类型：百分制 or 等级制 -->
            <div class="inline-group">
                <label>成绩类型：</label>
                <label>
                    <input type="radio"
                           name="grade_type"
                           value="percentage"
                           {% if grade_type == 'percentage' %}checked{% endif %}
                           onchange="toggleGradeInput()" />
                    百分制成绩
                </label>
                <label style="margin-left: 20px;">
                    <input type="radio"
                           name="grade_type"
                           value="letter"
                           {% if grade_type == 'letter' %}checked{% endif %}
                           onchange="toggleGradeInput()" />
                    等级制成绩
                </label>
            </div>

            <!-- 如果选“百分制”，显示数值输入框 -->
            <div id="percentage-input">
                <label for="grade_number">成绩（0-100）：</label>
                <input type="number"
                       id="grade_number"
                       name="grade_number"
                       min="0"
                       max="100"
                       step="0.1"
                       value="{{ grade_number }}"
                       {% if grade_type == 'percentage' %}required{% else %}disabled{% endif %} />
            </div>

            <!-- 如果选“等级制”，显示下拉框 -->
            <div id="letter-input" class="hidden">
                <label for="grade_letter">等级：</label>
                <select id="grade_letter" name="grade_letter">
                    <option value="优秀" {% if grade_letter == '优秀' %}selected{% endif %}>优秀</option>
                    <option value="良好" {% if grade_letter == '良好' %}selected{% endif %}>良好</option>
                    <option value="中等" {% if grade_letter == '中等' %}selected{% endif %}>中等</option>
                    <option value="及格" {% if grade_letter == '及格' %}selected{% endif %}>及格</option>
                    <option value="不及格" {% if grade_letter == '不及格' %}selected{% endif %}>不及格</option>
                </select>
            </div>

            <button type="submit">保存修改</button>
        </form>
    </div>

    <script>
        // 页面加载完成后，调用一次 toggleGradeInput()，根据后端传来的 grade_type 来显示/隐藏输入框
        document.addEventListener("DOMContentLoaded", function() {
            toggleGradeInput();
        });

        function toggleGradeInput() {
            const radios = document.getElementsByName("grade_type");
            let selectedType = "percentage";
            for (let r of radios) {
                if (r.checked) {
                    selectedType = r.value;
                    break;
                }
            }

            const percentageDiv = document.getElementById("percentage-input");
            const letterDiv = document.getElementById("letter-input");
            const gradeNumberInput = document.getElementById("grade_number");
            const gradeLetterSelect = document.getElementById("grade_letter");

            if (selectedType === "percentage") {
                percentageDiv.classList.remove("hidden");
                letterDiv.classList.add("hidden");
                gradeNumberInput.disabled = false;
                gradeNumberInput.required = true;
                gradeLetterSelect.disabled = true;
                gradeLetterSelect.required = false;
            } else {
                percentageDiv.classList.add("hidden");
                letterDiv.classList.remove("hidden");
                gradeNumberInput.disabled = true;
                gradeNumberInput.required = false;
                gradeLetterSelect.disabled = false;
                gradeLetterSelect.required = true;
            }
        }
    </script>
</body>
</html>
